---
title: 等价多路由ECMP技术
date: 2019-02-21 15:35:39
tags:
categories: Network
---

# 等价多路由ECMP简介

ECMP，Equal-Cost Multipath Routing，中文为等价多路径，表示存在多条不同链路路由到达同一目的地址的网络环境中。如果使用传统的路由技术，发往该目的地址的数据包只能利用其中的一条链路，其它链路处于备份状态或无效状态，并且在动态路由环境下相互的切换需要一定时间，而等值多路径路由协议可以在该网络环境下同时使用多条链路，不仅增加了传输带宽，并且可以无时延无丢包地备份失效链路的数据传输。

ECMP最大的特点是实现了等值情况下，多路径负载均衡和链路备份的目的，在静态路由和OSPF中基本上都支持ECMP功能。但是实际情况是，各路径的带宽、时延和可靠性等不一样，把Cost认可成一样，不能很好地利用带宽，尤其在路径间差异大时，效果会非常不理想。例如，路由器两个出口，两路径，一个带宽是100M，一个是2M，如果部署是ECMP，则网络总带宽只能达到4M的利用率。

为了实现负载分担，安全设备可以提供ECMP功能，对于每个接口去往同一目的的流量，支持最大3条等价路径。通过**一个计算源和目的IP地址散列值的算法，安全设备可以在特定网关之间实现流量的负载分担**。要注意的是，这并不能确保在这些网关中的流量分配是完全均等的。在下面的例子中，去往目的网络10.1.1.0/24有3条等价路径，它们会把流量发送给外部接口的3个不同的网关：

![](/images/network_ecmp_1_1.png)

同样，每台设备也可以定义最多不超过3条的等价默认路由。在下面的例子中，3条等价默认路由会把流量发送给外部接口的3个不同的网关：

![](/images/network_ecmp_1_2.png)

需要注意的是，**ECMP可以将一个报文，按照一定的HASH策略，HASH到一条指定的路由上，这样可以保证某一个网络会话能总是被HASH到一条路由上，也就是发送到同一个目的地址上**。这个在采用ECMP+OSPF的大型DPVS集群中有很大的作用哦。

学习资料参考于：
http://blog.sina.com.cn/s/blog_40952fbf01018jy3.html
